* Minimal UI
  #+begin_src emacs-lisp
    (scroll-bar-mode -1)
    (tool-bar-mode   -1)
    (tooltip-mode    -1)
    (menu-bar-mode   -1)
  #+end_src

* Set environment path
  #+begin_src emacs-lisp
    (if (string-equal system-type "windows-nt")
	(progn
	  (princ "set windows environment"))
      (setq exec-path (append exec-path '("/usr/local/bin"))))
  #+end_src

* Interface tweaks
** set font
   * Install Monaco font in Ubuntu:
     * check [[https://github.com/cstrap/monaco-font][How To]].
     * ~./install-font-ubuntu.sh http://www.gringod.com/wp-upload/software/Fonts/Monaco_Linux.ttf~
     * ~./install-font-ubuntu.sh http://www.gringod.com/wp-upload/software/Fonts/Monaco_Linux.ttf~
     * ~mkdir ~/.fonts~
     * ~cp Monaco_Linux.ttf ~/.fonts/~
   * [[http://ergoemacs.org/emacs/emacs_list_and_set_font.html][how to find the current font used]]
   * [[http://ergoemacs.org/emacs/emacs_unicode_fonts.html][best unicode fonts for programmer]]
   * Install regular font 
     #+begin_src emacs-lisp
       ;; to adjust font dynamically
       ;; C-xC-+ and C-xC-- to increase or decrease the buffer text size
       (cond
        ((string-equal system-type "windows-nt")
         (set-default-font "Consolas 12"))
        ;; ((string-equal system-type "gnu/linux")
        ;;  (set-default-font "Ubuntu Mono 12"))
        ((string-equal system-type "darwin")
         (if (member "Source Code Pro" (font-family-list))
             (set-default-font "Source Code Pro 12")
           (set-default-font "Menlo 11"))))
     #+end_src

     #+RESULTS:

   * Install all the icons
     #+begin_src emacs-lisp
       (use-package all-the-icons
         :ensure t 
         :defer t)
     #+end_src

     #+RESULTS:

     - After the package installed, run ~M-x all-the-icons-install-fonts~
     - In Windows10, after downloaded those fonts, go to the place to manually install theme.

** Mode line
   #+begin_src emacs-lisp
     (use-package doom-modeline
       :ensure t
       :hook (after-init . doom-modeline-mode))
   #+end_src


** alight commands
   #+BEGIN_SRC emacs-lisp
     (add-hook 'align-load-hook (lambda ()
                                  (add-to-list 'align-rules-list
                                               '(text-column-whitespace
                                                 (regexp  . "\\(^\\|\\S-\\)\\([ \t]+\\)")
                                                 (group   . 2)
                                                 (modes   . align-text-modes)
                                                 (repeat  . t)))))
   #+END_SRC
   - [[https://www.emacswiki.org/emacs/AlignCommands#toc5][Align Commands]]


** adjust meta key
   #+BEGIN_SRC emacs-lisp
     ;;; I prefer cmd key for meta
     (setq mac-option-key-is-meta nil
	   mac-command-key-is-meta t
	   mac-command-modifier 'meta
	   mac-option-modifier 'none)
   #+END_SRC

   #+RESULTS:
   : none

** set global key-bindings
   Use "C-h k" to check the meaning of command for which the current key-binding belongs to in current mode.
   #+begin_src emacs-lisp
     ;; resize bindings
     (global-set-key (kbd "C-s-<left>") 'shrink-window-horizontally)
     (global-set-key (kbd "C-s-<right>") 'enlarge-window-horizontally)
     (global-set-key (kbd "C-s-<down>") 'shrink-window)
     (global-set-key (kbd "C-s-<up>") 'enlarge-window)

     ;; use cmd + n and cmd + p to select next and previous lines
     (global-set-key (kbd "s-n") (kbd "C-S-n"))
     (global-set-key (kbd "s-p") (kbd "C-S-p"))
     ;; use c-z to undo
     (global-set-key (kbd "C-z") #'undo)

     ;; do code comment 
     (global-set-key (kbd "C-/") 'comment-or-uncomment-region)

     ;; use c-c c-c to execute a lisp function
     (global-set-key (kbd "C-c C-c") 'eval-last-sexp)

     ;; keyboard macro
     (global-set-key (kbd "<f2>") #'kmacro-start-macro)
     (global-set-key (kbd "<f3>") #'kmacro-end-macro)
     (global-set-key (kbd "<f4>") 'call-last-kbd-macro)


     ;; use f10 to format whole buffer
     (global-set-key (kbd "<f10>") (progn
                                     #'mark-whole-buffer
                                     #'indent-region))

   #+end_src

   #+RESULTS:
   : revert-buffer
** set buffer and shell
   #+begin_src emacs-lisp
     ;; no need for prompt for confirm when execute code block in org-mode
     ;; (setq org-confirm-babel-evaluate nil)

     ;; make sure environment variables inside Emacs look the same as in the user's shell
     (use-package exec-path-from-shell
       :defer 2
       :ensure t
       :config
       (progn
         (when (memq window-system '(mac ns x))
           (exec-path-from-shell-initialize))))
   #+end_src

   #+RESULTS:
   : t

** use y-or-n 
   #+begin_src emacs-lisp
     (fset 'yes-or-no-p 'y-or-n-p)

   #+end_src

   #+RESULTS:
   : y-or-n-p

** set adaptive-wrap
   #+BEGIN_SRC emacs-lisp
     (use-package adaptive-wrap
       :ensure t
       :config
       (progn
         ;; (setq-default adaptive-wrap-extra-indent 2)
         (global-visual-line-mode t)
         (add-hook 'visual-line-mode-hook #'adaptive-wrap-prefix-mode)))
   #+END_SRC

   #+RESULTS:
   : t

** highlight current line
   #+begin_src emacs-lisp
     (global-hl-line-mode +1)
   #+end_src 

   #+RESULTS:
   : t

** which-key
   #+begin_src emacs-lisp
     (use-package which-key
       :defer 2
       :ensure t
       :config (which-key-mode))
   #+end_src

** try
   #+begin_src emacs-lisp
     (use-package try
       :commands (try)
       :ensure t)
   #+end_src

** set trump-mode
   #+begin_src emacs-lisp
     (setq tramp-default-method "ssh")
   #+end_src

   #+RESULTS:
   : ssh

** display [[http://ergoemacs.org/emacs/emacs_pretty_lambda.html][pretty characters]]
   * refs
     * [[http://xahlee.info/comp/unicode_punctuation_symbols.html][common symbols]]
     * [[https://www.fileformat.info/info/unicode/char/2264/index.htm][place to find the relation between unicode and symbol]]
   * configuration
   #+begin_src emacs-lisp
     (define-globalized-minor-mode my-global-prettify-symbols-mode prettify-symbols-mode
       (lambda ()
         (setq prettify-symbols-alist
               '(
                 ("lambda" . 955) ; λ
                 ("->" . 8594)    ; →
                 ("<-" . 8592)    ; ←
                 ("=>" . 8658)    ; ⇒
                 ("<=" . 8656)    ; ⇐
                 ("map" . 8614)   ; ↦
                 ("checkmark" . 10003)   ; ✓
                 ))
         (prettify-symbols-mode 1)))

     (add-hook 'after-init-hook '(lambda ()
                                   (my-global-prettify-symbols-mode 1)))
   #+end_src

   #+RESULTS:
   : t

** set window to prefer split vertically
   #+begin_src emacs-lisp
     ;; (setq split-width-threshold 200)
     ;; (setq split-height-threshold 40)
   #+end_src

* Make swap buffers easier 
  #+begin_src emacs-lisp
    (use-package buffer-move
      :ensure t 
      :defer t)
  #+end_src
* Swiper/Ivy/Counsel
  Swiper gives us a really efficient incremental search with regular expressions and Ivy / Counsel replace a lot of ido or helms completion functionality
  #+begin_src emacs-lisp
    ;; it looks like counsel is a requirement for swiper
    (use-package counsel
      :defer 1
      :ensure t
      :bind
      (("M-y" . counsel-yank-pop)
       :map ivy-minibuffer-map
       ("M-y" . ivy-next-line)))

    (use-package ivy
      :defer 1
      :ensure t
      :diminish (ivy-mode)
      :bind (("C-x b" . ivy-switch-buffer))
      :config
      (ivy-mode 1)
      (setq ivy-use-virtual-buffers t)
      (setq ivy-count-format "%d/%d ")
      (setq ivy-display-style 'fancy))


    (use-package swiper
      :after (ivy counsel)
      :defer
      :ensure try
      :bind (("C-s" . swiper-isearch)
             ("C-c C-r" . ivy-resume)
             ;; ("C-x C-f" . counsel-find-file)
             ("M-x" . counsel-M-x))
      :config
      (progn
        (ivy-mode 1)
        (setq ivy-use-virtual-buffers t)
        (setq ivy-display-style 'fancy)
        (define-key read-expression-map (kbd "C-r") 'counsel-expression-history)))
  #+end_src
  
* Keep parentheses balanced
** Paredit
   #+begin_src emacs-lisp
     (use-package paredit
       :diminish
       :defer 1
       :ensure t
       :init
       (progn
         ;; (add-hook 'emacs-lisp-mode-hook       #'enable-paredit-mode)
         ;; (add-hook 'eval-expression-minibuffer-setup-hook #'enable-paredit-mode)
         ;; (add-hook 'ielm-mode-hook             #'enable-paredit-mode)
         ;; ;; (add-hook 'lisp-mode-hook             #'enable-paredit-mode)
         ;; (add-hook 'sly-mode-hook             #'enable-paredit-mode)
         ;; (add-hook 'lisp-interaction-mode-hook #'enable-paredit-mode)
         ;; (add-hook 'scheme-mode-hook           #'enable-paredit-mode)
         ;; (add-hook 'racket-mode-hook           #'enable-paredit-mode)

         ;; paredit with eldoc
         ;; (require 'eldoc) 
         ;; (eldoc-add-command
         ;;  'paredit-backward-delete
         ;;  'paredit-close-round)

         ;; paredit with electric return
         (defvar electrify-return-match
           "[\]}\)\"]"
           "If this regexp matches the text after the cursor, do an \"electric\"
             return.")
         (defun electrify-return-if-match (arg)
           "If the text after the cursor matches `electrify-return-match' then
             open and indent an empty line between the cursor and the text.  Move the
             cursor to the new line."
           (interactive "P")
           (let ((case-fold-search nil))
             (if (looking-at electrify-return-match)
                 (save-excursion (newline-and-indent)))
             (newline arg)
             (indent-according-to-mode)))
         ;; Using local-set-key in a mode-hook is a better idea.
         (global-set-key (kbd "RET") 'electrify-return-if-match)))
   #+end_src
** complements to paredit
   #+begin_src emacs-lisp
     ;; Show matching arenthesis
     (show-paren-mode 1)
     (setq show-paren-delay 0)
     (require 'paren)
     ;; (set-face-background 'show-paren-match (face-background 'default))
   #+end_src

   #+RESULTS:


** smartparens
   [[https://github.com/Fuco1/smartparens][smartparens]] is an excellent (newer) alternative to paredit. Many Clojure hackers have adopted it recently and you might want to give it a try as well.
   #+BEGIN_SRC emacs-lisp
     ;; (use-package smartparens
     ;;   :defer
     ;;   :ensure t
     ;;   :config
     ;;   (progn
     ;;     (add-hook 'js-mode-hook #'smartparens-mode)
     ;;     (add-hook 'typescript-mode-hook #'smartparens)
     ;;     (add-hook 'c-mode-hook #'smartparens-mode)
     ;;     (add-hook 'c++-mode-hook #'smartparens-mode)
     ;;     (add-hook 'web-mode-hook #'smartparens-mode)
     ;;     (add-hook 'shell-script-mode 'smartparens-mode)))
   #+END_SRC

   #+RESULTS:
   : t

* Helm
  #+BEGIN_SRC emacs-lisp
    (use-package helm
      :diminish
      :ensure t
      :config
      (progn
        (use-package helm-xref
          :ensure t)

        ;; The default "C-x c" is quite close to "C-x C-c", which quits Emacs.
        ;; Changed to "C-c h". Note: We must set "C-c h" globally, because we
        ;; cannot change `helm-command-prefix-key' once `helm-config' is loaded.
        (global-set-key (kbd "C-c h") 'helm-command-prefix)
        (global-unset-key (kbd "C-x c"))

        ;; C-x C-f runs the command counsel-find-file
        (global-unset-key (kbd "C-x C-f"))
        (global-set-key (kbd "C-x C-f") #'helm-find-files)

        (define-key helm-map (kbd "<tab>") 'helm-execute-persistent-action) ; rebind tab to run persistent action
        (define-key helm-map (kbd "C-i") 'helm-execute-persistent-action) ; make TAB work in terminal
        (define-key helm-map (kbd "C-z")  'helm-select-action) ; list actions using C-z

        (when (executable-find "curl")
          (setq helm-google-suggest-use-curl-p t))

        (setq helm-split-window-in-side-p           t ; open helm buffer inside current window, not occupy whole other window
              helm-move-to-line-cycle-in-source     t ; move to end or beginning of source when reaching top or bottom of source.
              helm-ff-search-library-in-sexp        t ; search for library in `require' and `declare-function' sexp.
              helm-scroll-amount                    8 ; scroll 8 lines other window using M-<next>/M-<prior>
              helm-ff-file-name-history-use-recentf t
              helm-echo-input-in-header-line t

              ;; optional fuzzy matching for helm-M-x
              helm-M-x-fuzzy-match t
              helm-buffers-fuzzy-matching t
              helm-recentf-fuzzy-match t
              helm-completion-in-region-fuzzy-match t
              helm-imenu-fuzzy-match t

              ;; TOOD: helm-semantic has not syntax coloring! How can I fix that?
              helm-semantic-fuzzy-match t)

        (setq xref-show-xrefs-function 'helm-xref-show-xrefs)

        (defun spacemacs//helm-hide-minibuffer-maybe ()
          "Hide minibuffer in Helm session if we use the header line as input field."
          (when (with-helm-buffer helm-echo-input-in-header-line)
            (let ((ov (make-overlay (point-min) (point-max) nil nil t)))
              (overlay-put ov 'window (selected-window))
              (overlay-put ov 'face
                           (let ((bg-color (face-background 'default nil)))
                             `(:background ,bg-color :foreground ,bg-color)))
              (setq-local cursor-type nil))))

        (add-hook 'helm-minibuffer-set-up-hook
                  'spacemacs//helm-hide-minibuffer-maybe)

        (setq helm-autoresize-max-height 35)
        (setq helm-autoresize-min-height 0)
        (helm-autoresize-mode 1)
        (helm-mode 1)))
  #+END_SRC

  #+RESULTS:
  : t
* The Silver Searcher
  #+begin_src emacs-lisp
    (use-package ag
      :ensure t
      :defer t)

    (use-package helm-ag
      :ensure t
      :defer t
      :after (helm))
  #+end_src
  - need to install [[~https://github.com/ggreer/the_silver_searcher][ag]]
* Rainbow-delimiters
  #+BEGIN_SRC emacs-lisp
    (use-package rainbow-delimiters
      :defer
      :ensure t)
  #+END_SRC

  #+RESULTS:
  : t

* Ace-window
  #+begin_src emacs-lisp
    (use-package ace-window
      :defer 2
      :ensure t
      :init
      :config
      (progn
	(setq aw-scope 'frame)
	(global-set-key (kbd "C-x O") 'other-frame)
	(global-set-key [remap other-window] 'ace-window)
	(custom-set-faces
	 '(aw-leading-char-face
	   ((t (:inherit ace-jump-face-foreground :height 3.0)))))))
  #+end_src

  #+RESULTS:
  : t

* Magit
  #+begin_src emacs-lisp
    (use-package magit
      :bind (("C-x g" . magit))
      :ensure t)
  #+end_src

  # #+RESULTS:

* Treemacs
  #+begin_src emacs-lisp
    (use-package treemacs
      :defer t
      :ensure t
      :init
      (use-package lv
        :defer t
        :ensure t)
      (with-eval-after-load 'winum
        (define-key winum-keymap (kbd "M-0") #'treemacs-select-window))
      (setq treemacs-collapse-dirs              (if (executable-find "python") 3 0)
            treemacs-file-event-delay           5000
            treemacs-follow-after-init          t
            treemacs-follow-recenter-distance   0.1
            treemacs-goto-tag-strategy          'refetch-index
            treemacs-indentation                2
            ;; indent guide
            ;; treemacs-indentation-string (propertize " | " 'face 'font-lock-comment-face)
            ;; treemacs-indentation-string         "|"
            treemacs-is-never-other-window      nil
            treemacs-no-png-images              nil
            treemacs-project-follow-cleanup     nil
            treemacs-file-follow-delay          nil
            treemacs-recenter-after-file-follow nil
            treemacs-recenter-after-tag-follow  nil
            treemacs-show-hidden-files          t
            treemacs-silent-filewatch           nil
            treemacs-silent-refresh             nil
            treemacs-sorting                    'alphabetic-desc
            treemacs-tag-follow-cleanup         t
            treemacs-tag-follow-delay           1.5
            treemacs-width                      40
            treemacs-follow-mode                t
            treemacs-filewatch-mode             t
            treemacs-git-mode nil)
      :config
      :bind
      (:map global-map
            ([f8]        . treemacs)
            ("M-0"       . treemacs-select-window)
            ("C-x t 1"   . treemacs-delete-other-windows)
            ("C-x t t"   . treemacs)
            ("C-x t B"   . treemacs-bookmark)
            ("C-x t C-t" . treemacs-find-file)
            ("C-x t M-t" . treemacs-find-tag)))

    ;; (use-package treemacs-evil
    ;;   :defer t
    ;;   :after (treemacs evil) 
    ;;   :ensure t)

    (use-package treemacs-projectile
      :defer t
      :after (treemacs projectile)
      :ensure t)

    (use-package treemacs-icons-dired
      :defer t
      :after (treemacs dired)
      :ensure t
      :config (treemacs-icons-dired-mode))
  #+end_src

  #+RESULTS:

* expand-region
  #+begin_src emacs-lisp
    (use-package expand-region
      :ensure t
      :config
      (progn
        (global-set-key (kbd "C-=") 'er/expand-region)
        (global-set-key (kbd "C--") 'er/contract-region)))
  #+end_src

  #+RESULTS:
  : t

* ggtags
  #+begin_src emacs-lisp
    (use-package ggtags
      :defer t
      :ensure t
      :config
      (progn
        (add-hook 'ggtags-mode-hook
                  (lambda ()
                    (setq-local company-backends (add-to-list 'company-backends 'company-gtags))))))
  #+end_src

  #+RESULTS:
  : t

* Lisp Programming
** Aggressive-indent-mode
   #+BEGIN_SRC emacs-lisp
     (use-package aggressive-indent
       :ensure t
       :config
       (add-to-list 'aggressive-indent-excluded-modes 'html-mode))
   #+END_SRC

   #+RESULTS:
   : t

** Eldoc to show argument list
   #+begin_src emacs-lisp
     (use-package eldoc
       :diminish
       :defer t
       :ensure t
       :init
       ;; highlight eldoc arguments in emacslisp
       (defun eldoc-get-arg-index ()
         (save-excursion
           (let ((fn (eldoc-fnsym-in-current-sexp))
                 (i 0))
             (unless (memq (char-syntax (char-before)) '(32 39)) ; ? , ?'
               (condition-case err
                   (backward-sexp)             ;for safety
                 (error 1)))
             (condition-case err
                 (while (not (equal fn (eldoc-current-symbol)))
                   (setq i (1+ i))
                   (backward-sexp))
               (error 1))
             (max 0 i))))

       (defun eldoc-highlight-nth-arg (doc n)
         (cond ((null doc) "")
               ((<= n 0) doc)
               (t
                (let ((i 0))
                  (mapconcat
                   (lambda (arg)
                     (if (member arg '("&optional" "&rest"))
                         arg
                       (prog2
                           (if (= i n)
                               (put-text-property 0 (length arg) 'face 'underline arg))
                           arg
                         (setq i (1+ i)))))
                   (split-string doc) " ")))))

       (defadvice eldoc-get-fnsym-args-string (around highlight activate)
         ""
         (setq ad-return-value (eldoc-highlight-nth-arg ad-do-it
                                                        (eldoc-get-arg-index))))
       (add-hook 'lisp-interaction-mode-hook 'turn-on-eldoc-mode)
       (add-hook 'ielm-mode-hook 'turn-on-eldoc-mode))
   #+end_src

   #+RESULTS:
   : t

** Common-lisp
   #+begin_src emacs-lisp
     (use-package sly
       ;; use ~sly~ to connect to REPL
       :ensure t
       :mode ("\\.lisp\\'" "\\.cl\\'")
       :defer t
       :init
       (setq inferior-lisp-program "sbcl")
       (setq sly-lisp-implementations
             '((sbcl ("/usr/local/bin/sbcl") :coding-system utf-8-unix)))
       :commands (sly-mode))
   #+end_src

   #+RESULTS:
   : t

** Racket
   #+begin_src emacs-lisp
     (use-package racket-mode
       :defer t
       :init
       (cond
        ((string-equal system-type "windows-nt")
         (setq racket-program "c:/Program Files/Racket/Racket.exe"))
        ((string-equal system-type "gnu/linux")
         (setq racket-program "/usr/bin/racket"))
        ((string-equal system-type "darwin")
         (setq racket-program "/Applications/Racket_v7.0/bin/racket")))
       ;; set racket-mode associated with racket-mode
       (add-to-list 'auto-mode-alist '("\\.racket\\'" . racket-mode))
       (add-to-list 'auto-mode-alist '("\\.rkt\\'" . racket-mode))
       :mode "\\.racket\\'"
       :ensure t
       :config
       (progn
         (add-hook 'racket-mode-hook
                   (lambda ()
                     (define-key racket-mode-map (kbd "C-c r") 'racket-run)))
         (add-hook 'racket-mode-hook      #'racket-unicode-input-method-enable)
         (add-hook 'racket-repl-mode-hook #'racket-unicode-input-method-enable)))
   #+end_src

   #+RESULTS:
   : t

** Scheme
   #+begin_src emacs-lisp
     (use-package geiser
       :defer t
       :init
       ;; append exec-path to include chez scheme
       (cond ((eq system-type 'windows-nt)
              (setq exec-path (append exec-path '("c:/Program Files (x86)/Chez Scheme 9.5/bin/ti3nt"))))
             ((eq system-type 'darwin)
              (setq exec-path (append exec-path '("/usr/local/bin"))))
             ((eq system-type 'gnu/linux)
              (setq exec-path (append exec-path '("/usr/bin")))))
       ;; set Library directories
       (cond ((eq system-type 'windows-nt)
              (setenv "CHEZSCHEMELIBDIRS" "C:\\scheme\\lib;")
              (setenv "CHEZSCHEMELIBEXTS" ".sc;;.so;"))
             ((eq system-type 'darwin)
              ;; raven is the chez scheme package management tool
              (setenv "CHEZSCHEMELIBDIRS" "/usr/local/lib/raven")
              (setenv "CHEZSCHEMELIBEXTS" ".sc::.so:"))
             (t
              nil))

       (cond ((eq system-type 'darwin)
              (setq geiser-chez-binary "chez"))
             (t
              (setq geiser-chez-binary "chezscheme9.5")))

       (setq geiser-active-implementations '(guile chez))
       (setq geiser-mode-start-repl-p t)
       (add-to-list 'auto-mode-alist '("\\.scheme\\'" . scheme-mode))
       ;; (add-to-list 'auto-mode-alist '("\\.racket\\'" . scheme-mode))
       ;; (add-to-list 'auto-mode-alist '("\\.rkt\\'" . scheme-mode))
       (add-hook 'scheme-mode-hook 'geiser-mode)
       :ensure t)
   #+end_src
   

** Clojure programming
*** CIDER
    It is the Clojure(Script) Interactive Development Environment.
    #+BEGIN_SRC emacs-lisp
      (use-package cider
        :init
        ;; (setq cider-jack-in-default 'lein)
        (setq cider-jack-in-default 'boot)
        ;; (setq cider-default-cljs-repl 'boot)
        (if (string-equal system-type "windows-nt")
            (add-to-list 'exec-path "c:/ProgramData/chocolatey/bin/")
          nil)
        :commands (cider)
        :ensure t)

      (use-package helm-cider
        :after (cider helm)
        :ensure t
        :init
        (add-hook 'cider-repl-mode-hook #'helm-cider-mode))
    #+END_SRC

    #+RESULTS:
    : t
    - Troubleshooting: Could not start nREPL server: java.io.IOException: Permission denied.
      Solution: check the ~/.lein folder's permission, use chown to change it.
   
*** Clojure-mode
    #+BEGIN_SRC emacs-lisp
      (use-package clojure-mode
        :defer t
        :ensure t
        :config
        (progn
          (setq clojure-align-forms-automatically t)
          ;; In order for Emacs to recognise .boot files as valid Clojure source code
          (add-to-list 'auto-mode-alist '("\\.boot\\'" . clojure-mode))
          (add-to-list 'auto-mode-alist '("\\.edn\\'" . clojure-mode))
          ;; set how code indent for some forms
          ;; see https://docs.cider.mx/cider/config/indentation.html
          (define-clojure-indent
            (set-env! 0)
            (require 0))))
    #+END_SRC

    #+RESULTS:
    : t

*** Org-babel-clojure configuration
    #+begin_src emacs-lisp
      (setq org-babel-clojure-backend 'cider)
    #+end_src

    #+RESULTS:
    : cider

*** adoc-mode for reading [[https://github.com/clojure-cookbook/clojure-cookbook][Clojure Cookbook]]   
    #+begin_src emacs-lisp
      (use-package adoc-mode
        :defer t
        :after (cider-mode)
        :commands (adoc-mode)
        :init
        (add-to-list 'auto-mode-alist (cons "\\.txt\\'" 'adoc-mode))
        (add-to-list 'auto-mode-alist (cons "\\.asciidoc\\'" 'adoc-mode))

        :ensure t
        :config
        (progn
          (defun increment-clojure-cookbook ()
            "When reading the Clojure cookbook, find the next section, and close the buffer. If the next section is a sub-directory or in the next chapter, open Dired so you can find it manually."
            (interactive)
            (let* ((cur (buffer-name))
                   (split-cur (split-string cur "[-_]"))
                   (chap (car split-cur))
                   (rec (car (cdr split-cur)))
                   (rec-num (string-to-number rec))
                   (next-rec-num (1+ rec-num))
                   (next-rec-s (number-to-string next-rec-num))
                   (next-rec (if (< next-rec-num 10)
                                 (concat "0" next-rec-s)
                               next-rec-s))
                   (target (file-name-completion (concat chap "-" next-rec) "")))
              (progn 
                (if (equal target nil)
                    (dired (file-name-directory (buffer-file-name)))
                  (find-file target))
                (kill-buffer cur))))
          (define-key adoc-mode-map (kbd "M-+") 'increment-clojure-cookbook)
          (add-hook 'adoc-mode-hook 'cider-mode)))
    #+end_src

    #+RESULTS:
    : t

*** Userful key-bindings in Clojure programming
    - C-c C-d C-d will display documentation for the symbol under point, which can be a huge time-saver.
    - M-. will navigate to the source code for the symbol under point
    - M-, will return you to your original buffer and position
    - C-c C-d C-a lets you search for arbitrary text across function names and documentation
    - For paredit
      - M-( Surround expression after point in parentheses (paredit-wrap-round).
      - C-<left or right arrow>, surp or barf
      - C-M-f, C-M-b Move to the opening/closing parenthesis.

** Common configuration 
   #+begin_src emacs-lisp
     ;; define additional minor mode to adjust keybindings without conflicts
     (defvar my-lisp-power-map (make-keymap))
     (define-minor-mode my-lisp-power-mode "Fix keybindings; add power."
       :lighter " (power)"
       :keymap my-lisp-power-map)
     (define-key my-lisp-power-map [delete] 'paredit-forward-delete)
     (define-key my-lisp-power-map [backspace] 'paredit-backward-delete)

     ;; define a group of common features needed by all lisp programming
     (defun zwpdbh/enhance-lisp-power ()
       (interactive)
       (my-lisp-power-mode t)
       (turn-on-eldoc-mode)
       (subword-mode t)
       (paredit-mode t)
       (rainbow-delimiters-mode-enable)
       (aggressive-indent-mode t))

     ;; define a group of different lisp modes, so we could apply features on on them 
     (setq my-lisp-mode-set '(lisp-mode
                              lisp-interaction-mode
                              emacs-lisp-mode
                              sly-mode
                              ielm-mode
                              eval-expression-minibuffer-setup
                              common-lisp-mode
                              racket-mode
                              racket-repl-mode
                              scheme-mode
                              clojure-mode
                              cider-repl-mode
                              geiser-repl-mode))

     (add-hook 'after-init-hook '(lambda ()
                                   (dolist (each-mode my-lisp-mode-set)
                                     (add-hook (intern (format "%s-hook" each-mode))
                                               #'zwpdbh/enhance-lisp-power))))
   #+end_src

* Other Programming
** Dap-mode
   #+begin_src emacs-lisp
     (use-package dap-mode
       :ensure t
       :config
       (progn
         (dap-mode 1)
         (dap-ui-mode 1)
         (dap-tooltip-mode 1)
         (setq tooltip-mode t)

         ;; dap-mode also provides a hydra with dap-hydra
         (add-hook 'dap-stopped-hook
                   (lambda (arg) (call-interactively #'dap-hydra)))

         ;; for javascript node debug 
         (require 'dap-node)
         (dap-register-debug-template
          "Node::zwpdbh-debug"
          (list :type "node"
                :cwd nil
                :request "launch"
                :program nil
                :name "Node::zwpdbh-debug"))))
   #+end_src
   - Need to call ~dap-node-setup~ for setting up vscode extension.
   - Make sure the ~dap-node-debug-program~ is pointing to the proper file.    

** Lsp
   #+begin_src emacs-lisp
     (use-package lsp-mode
       :defer t
       :init
       (require 'lsp-clients)
       (setq lsp-message-project-root-warning t)
       ;; change nil to 't to enable logging of packets between emacs and the LS
       ;; this was invaluable for debugging communication with the MS Python Language Server
       ;; and comparing this with what vs.code is doing
       (setq lsp-print-io nil)
       :ensure t)

     (use-package helm-lsp 
       :after (helm lsp)
       :commands helm-lsp-workspace-symbol)
     (use-package lsp-treemacs 
       :after (lsp treemacs)
       :commands lsp-treemacs-errors-list)

     (use-package company-lsp
       :after (company lsp)
       :init 
       (setq company-lsp-cache-candidates nil)
       (setq company-lsp-async t)
       (setq company-lsp-enable-recompletion t)
       :ensure t)

     (use-package lsp-ui
       :after (lsp)
       :init 
       (setq lsp-ui-peek-force-fontify t)
       (setq lsp-ui-imenu-enable t)
       (setq lsp-ui-sideline-ignore-duplicate t)
       (setq lsp-ui-sideline-enable nil)
       (setq lsp-ui-doc-enable nil)
       (add-hook 'lsp-mode-hook 'lsp-ui-mode)
       :ensure t
       :config
       (progn
         (define-key lsp-ui-mode-map [remap xref-find-definitions] #'lsp-ui-peek-find-definitions)
         (define-key lsp-ui-mode-map [remap xref-find-references] #'lsp-ui-peek-find-references)))
   #+end_src

   #+RESULTS:
   : t

** Format
   !!! Do not forget to install clang-format: =sudo apt install clang-format=.
   #+begin_src emacs-lisp
     (use-package clang-format
       :defer t
       :ensure t
       :config
       (progn
         (defun clang-format-buffer-smart ()
           "Reformat buffer if .clang-format exists in the projectile root."
           (when (f-exists? (expand-file-name ".clang-format" (projectile-project-root)))
             (clang-format-buffer)))

         (dolist (each-hook '(c-mode-hook c++-mode-hook js-mode-hook))
           (add-hook each-hook 
                     #'(lambda ()
                         (add-hook 'before-save-hook #'clang-format-buffer-smart nil 'local)))))) 

     (use-package yaml-mode
       :defer t
       :ensure t
       :config
       (progn
         (add-hook 
          'yaml-mode-hook 
          #'(lambda ()
              (setq yaml-indent-offset 2)
              ;; (smartparens-mode)
              (remove-hook 'before-save-hook #'clang-format-buffer-smart 'local)))))
   #+end_src

   #+RESULTS:
   : t

** yasnippet
   #+begin_src emacs-lisp
     (use-package yasnippet
       :defer 1
       :ensure t
       :diminish yas-minor-mode
       :config (yas-global-mode t))
   #+end_src

   #+RESULTS:
   : t

** Scala programming
*** ensime
    # #+begin_src emacs-lisp
    #   (use-package ensime
    #     :defer t
    #     :mode "\\.scala\\'"
    #     :init 
    #     (if (string-equal system-type "windows-nt")
    #         (progn
    #           (setq exec-path (append exec-path '("c:/Program Files (x86)/scala/bin")))
    #           (setq exec-path (append exec-path '("c:/Program Files (x86)/sbt/bin"))))
    #       (setq exec-path (append exec-path '("/usr/local/bin"))))
    #     :ensure t
    #     :config
    #     (progn
    #       ;; (add-hook 'scala-mode-hook 'ensime-scala-mode-hook)
    #       (add-hook 'scala-mode-hook 'ensime-mode)))
    # #+end_src

    #+RESULTS:
    : t
    
** Python development
*** with lsp 
    - References
      - [[https://vxlabs.com/2018/11/19/configuring-emacs-lsp-mode-and-microsofts-visual-studio-code-python-language-server/][Configuring Emacs, lsp-mode and Microsoft's Visual Studio Code Python language server.]] (using)
    - Components
      - server: Microsoft Python Language Server
      - client: lsp-python-ms
      - installation
        - install [[https://dotnet.microsoft.com/download][dotnet-sdk]]
          - [[https://dotnet.microsoft.com/download/linux-package-manager/ubuntu18-04/sdk-current][installation on ubuntu18.04]]
        - clone and install [[https://github.com/Microsoft/python-language-server][python-language-server]]
          - Configuration with emacs
            #+begin_src emacs-lisp
              (use-package lsp-python-ms
                :defer t
                :init 
                (setq python-shell-interpreter "python3")
                (setq lsp-python-ms-dir
                      (expand-file-name "~/python-language-server/output/bin/Release/"))
                (setq lsp-python-ms-executable
                      "~/python-language-server/output/bin/Release/Microsoft.Python.LanguageServer")
                (add-hook 'python-mode-hook 'lsp-mode)
                ;; (add-hook 'python-mode-hook #'smartparens-mode)
                :ensure t)
            #+end_src

            #+RESULTS:
            : t



*** Debugging
    Debugg using pdb
    #+BEGIN_SRC python
      # import ipd
      # ipdb.set_trace ()
    #+END_SRC

*** Test Integration
    Configure your test Runner
    M-x elpy-set-test-runner
    C-c C-t  ;; runs test/ all tests

** C/C++ programming
*** with lsp
    - Components
      - install clang: =sudo apt install clang=
      - install clangd: [[https://clang.llvm.org/extra/clangd/Installation.html#installing-clangd][Getting started with clangd]]
      - Configuration with emacs
	#+begin_src emacs-lisp
          (use-package cquery
            :defer t
            :init
            (setq cquery-executable "/usr/local/bin/cquery")
            (setq cquery-extra-init-params '(:completion (:detailedLabel t)))
            (defun cquery//enable ()
              (condition-case nil
                  (lsp)
                (user-error nil)))
            (add-hook 'c-mode-common-hook
                      (lambda ()
                        (when (derived-mode-p 'c-mode 'c++-mode)
                          (ggtags-mode 1)
                          (cquery//enable))))
            :ensure t)
	#+end_src

	#+RESULTS:
	: t

*** CMakeLists
    #+begin_src emacs-lisp
      (use-package cmake-mode
        :defer t
        :init 
        (add-hook 'cmake-mode-hook #'(lambda ()
                                       ;; (smartparens-mode +1)
                                       ))
        :ensure t)
    #+end_src

** Javascript
   #+begin_src emacs-lisp
     (use-package js2-mode
       :defer t
       :init
       :ensure t
       :config
       (progn
         (setq-default js2-bounce-indent-p nil)
         (setq-default js-indent-level 2)
         ;; In Emacs >= 25, the following is an alias for js-indent-level anyway
         (setq-default js2-basic-offset 2)))

     (add-to-list 'interpreter-mode-alist (cons "node" 'js2-mode))
     (add-to-list 'auto-mode-alist '("\\.\\(js\\|es6\\)\\(\\.erb\\)?\\'" . js2-mode))
     ;; (add-to-list 'auto-mode-alist '("\\.js\\'" . js2-mode))
     (add-to-list 'interpreter-mode-alist '("node" . js2-mode))

     (after-load 'js2-mode
       ;; Disable js2 mode's syntax error highlighting by default...
       (setq-default js2-mode-show-parse-errors nil
                     js2-mode-show-strict-warnings nil)
       ;; ... but enable it if flycheck can't handle javascript
       (autoload 'flycheck-get-checker-for-buffer "flycheck")
       (defun sanityinc/enable-js2-checks-if-flycheck-inactive ()
         (unless (flycheck-get-checker-for-buffer)
           (setq-local js2-mode-show-parse-errors t)
           (setq-local js2-mode-show-strict-warnings t)))
       (add-hook 'js2-mode-hook 'sanityinc/enable-js2-checks-if-flycheck-inactive)
       (add-hook 'js2-mode-hook 'lsp)
       (add-hook 'js2-mode-hook (lambda () (setq mode-name "JS2")))

       (js2-imenu-extras-setup))

     ;; ;; define how to find definitions and references
     ;; (when (and (executable-find "ag")
     ;;            (maybe-require-package 'xref-js2))
     ;;   (after-load 'js2-mode
     ;;     (define-key js2-mode-map (kbd "M-.") nil)
     ;;     (add-hook 'js2-mode-hook
     ;;               (lambda () (add-hook 'xref-backend-functions #'xref-js2-xref-backend nil t)))))

     (when (maybe-require-package 'add-node-modules-path)
       (after-load 'typescript-mode
         (add-hook 'typescript-mode-hook 'add-node-modules-path))
       (after-load 'js2-mode
         (add-hook 'js2-mode-hook 'add-node-modules-path)))



     ;; (use-package company-tern
     ;;   :defer t
     ;;   :after (company tern)
     ;;   :commands (company-tern)
     ;;   :ensure t
     ;;   :init 
     ;;   (setq tern-command (append tern-command '("--no-port-file"))))

     ;; (use-package tern
     ;;   :ensure t
     ;;   :defer t)
     ;; (add-hook 'js-mode-hook 
     ;;           #'(lambda ()
     ;;               (setq-local company-backends (add-to-list 'company-backends 'company-tern))
     ;;               (tern-mode)))






   #+end_src
   - flow-based autocomplete for emacs with [[https://github.com/aaronjensen/company-flow][company-flow]], need to install [[https://github.com/facebook/flow][flow]]
   - Tern is a stand-alone code-analysis engine for JavaScript, need to install: ~sudo npm install -g tern~.

** Web/Javascript programming
*** Web-mode for vue.js 
    #+BEGIN_SRC emacs-lisp
      (defun my/web-vue-setup()
        "Setup for js related."
        (message "web-mode use vue related setup")
        (require 'company-css)
        (setq-local company-backends (append '(company-web-html company-css) company-backends))
        (setq-local company-backends (add-to-list 'company-backends 'company-tern))
        (tern-mode)
        (flycheck-add-mode 'javascript-eslint 'web-mode)
        (flycheck-select-checker 'javascript-eslint)
        (my/use-eslint-from-node-modules))

      (use-package web-mode
        :defer t
        :ensure t
        :mode ("\\.html\\'" "\\.vue\\'")
        :config
        (setq web-mode-markup-indent-offset 2)
        (setq web-mode-css-indent-offset 2)
        (setq web-mode-code-indent-offset 2)
        (setq web-mode-enable-current-element-highlight t)
        (setq web-mode-enable-css-colorization t)
        ;; (set-face-attribute 'web-mode-html-tag-face nil :foreground "royalblue")
        ;; (set-face-attribute 'web-mode-html-attr-name-face nil :foreground "powderblue")
        ;; (set-face-attribute 'web-mode-doctype-face nil :foreground "lightskyblue")
        (setq web-mode-content-types-alist
              '(("vue" . "\\.vue\\'")))

        (add-hook 'web-mode-hook (lambda()
                                   (cond ((equal web-mode-content-type "html")
                                          ;; TODO: implement my/web-html-setup for html properly
                                          ;; (my/web-html-setup)
                                          (my/web-vue-setup))
                                         ((member web-mode-content-type '("vue"))
                                          (my/web-vue-setup))))))

      (use-package emmet-mode
        :ensure t
        :defer t
        :config
        (progn
          (add-hook 'web-mode-hook  'emmet-mode)))

      (use-package company-web
        :commands (web-mode)
        :defer t 
        :after (company web-mode)
        :ensure t)

      (defun my/use-eslint-from-node-modules ()
        "Use local eslint from node_modules before global."
        (let* ((root (locate-dominating-file
                      (or (buffer-file-name) default-directory)
                      "node_modules"))
               (eslint (and root
                            (expand-file-name "node_modules/eslint/bin/eslint.js"
                                              root))))
          (when (and eslint (file-executable-p eslint))
            (setq-local flycheck-javascript-eslint-executable eslint))))
      (add-hook 'flycheck-mode-hook #'my/use-eslint-from-node-modules)
    #+END_SRC

    #+RESULTS:
    | my/use-eslint-from-node-modules | flycheck-yamllint-setup | flycheck-mode-set-explicitly |

*** References    
    #+begin_example
      I am the best person to answer this question. If you are the js developer using Emacs, you are already running Emacs Lisp code written by me.

      Now answer you question:

      for project tree view. neotree is very popular. But advanced user don’t bother using file explorer, they just fuzzy search file in project. For file searching, most users use projectile. But I highly recommend find-file-in-project. It’s quick, easy to setup (no setup for most projects actually). find-file-in-project is endorsed by guys who developed elpy/hydra/swiper/ace-window/lispy/avy.
      lint is done automatically by js2-mode, no setup needed. Extra tip, you may need tweak `js2-additional-externs` in `js2-post-parse-callbacks` when working on large legacy project.
      I use mozrepl to refresh the firefox. I know all the related Emacs plugins. But I’ve made my choice to stick to mozrepl. For local http server, you can use simple-httpd. Firefox plugin keysnail make me 1000% faster on web development.
      for code completion, you need install company-mode, you may need setup backend tern (if you use company-tern) or ctags (if you use company-etags). I prefer ctags way.
      Extra tips:

      If you use js2-mode, you’d better enable js2-imenu-extras-mode, then `M-x helm-imenu` (if you install helm) or `M-x counsel-imenu` (if you install counsel)

      In js2-mode, you can also `M-x js2-print-json-path`
    #+end_example

** go programming
   * [[https://www.digitalocean.com/community/tutorials/how-to-install-go-on-ubuntu-18-04][How To Install Go on Ubuntu 18.04]]
   * go-mode with ob-go
     #+begin_src emacs-lisp
       (add-to-list 'auto-mode-alist '("\\.go\\'" . go-mode))

       (use-package go-mode
         :defer t
         :init 
         (if (string-equal system-type "gnu/linux")
             (add-to-list 'exec-path "/usr/local/go/bin")
           nil)
         :ensure t)

       (use-package ob-go
         :defer 2 
         :ensure t
         :config
         (add-to-list 'org-structure-template-alist '("go" . "src go"))
         (org-babel-do-load-languages
          'org-babel-load-languages
          '((go . t))))
     #+end_src

     #+RESULTS:
   * Test go example
     #+begin_src go :imports "fmt"
       fmt.Println("Hello, 世界")
     #+end_src

     #+RESULTS:
     : Hello, 世界




** Java programming
   [[http://www.goldsborough.me/emacs,/java/2016/02/24/22-54-16-setting_up_emacs_for_java_development/][blog shows how to setup emacs for java development]]
   
* R programming
** configuration 
   #+begin_src emacs-lisp
     (use-package electric-spacing
       :after (ess)
       :defer t
       :ensure t)

     (use-package ess
       :defer t
       :ensure t
       :init 
       (require 'ess-site)
       (cond ((eq system-type 'darwin)
              (setq inferior-ess-r-program "/usr/local/bin/R"))
             ((eq system-type 'gnu/linux)
              (setq inferior-ess-r-program "/usr/local/bin/R"))
             ((eq system-type 'windows-nt)
              ;; you may also need to add execution path to windows system environment
              (setq exec-path (append exec-path '("C:/tools/R/R-3.6.2/bin")))
              (setq inferior-ess-r-program "C:/tools/R/R-3.6.2/bin/R.exe")))
       (setq comint-input-ring-size 1000
             ess-indent-level 4
             ess-arg-function-offset 4
             ess-else-offset 4
             ess-continued-statement-offset 2
             truncate-lines t
             comment-column 4)		
       (add-hook 'ess-mode-hook 
                 '(lambda () 
                    (electric-spacing-mode))))
   #+end_src


** references
   - [[https://jmonlong.github.io/Hippocamplus/emacs/#for-r]]

* Org mode enhancement
** common settings
   #+BEGIN_SRC emacs-lisp
     (use-package org
       :defer t
       :ensure org-plus-contrib)

     ;; To bind a key in a mode, you need to wait for the mode to be loaded before defining the key.
     (eval-after-load 'org
       #'(lambda ()
           (require 'ob)
           (require 'ob-js)
           (require 'org-eldoc)
           (require 'org-tempo)

           (global-set-key (kbd "<f12>") (kbd "C-c '"))
           (define-key org-mode-map [f5] #'org-toggle-inline-images)
           (define-key org-mode-map [f11] #'org-toggle-narrow-to-subtree)))

     (define-key global-map "\C-cl" 'org-store-link)
     (define-key global-map "\C-ca" 'org-agenda)

     (add-hook 'org-mode-hook '(lambda ()
                                 ;; set org to user the current window when edit src code
                                 (setq org-src-window-setup 'current-window)
                                 (setq org-log-done t)))
   #+END_SRC

** org-agenda-files
   In case some org files is not listed in agenda files, run the code block again to refresh the file list.
   Another way is to invoke the function ~org-agenda-file-to-front~.
   #+begin_src emacs-lisp
     ;; make org-agenda to search all the TODOs recursively for files .org in folder "~/code/org/"
     (setq org-agenda-files (directory-files-recursively "~/code/capture-org/" "\\.org$"))
   #+end_src

** make code-block could be executed in org-mode
   #+begin_src emacs-lisp
     ;; evaluation lisp using sly instead of slime, need to use org-plus-contrib
     (setq org-babel-lisp-eval-fn #'sly-eval)

     ;; http request in org-mode babel, requires curl
     (use-package ob-http
       :after (org)
       :defer t
       :ensure t)

     ;; since yaml mode is not supported by org, create the command yourself
     (defun org-babel-execute:yaml (body params) body)
     (defun org-babel-execute:json (body params) body)

     (add-hook 'org-mode-hook #'(lambda ()
                                  (progn
                                    ;; all languages needed to be confirmed to execute except:
                                    (defun my-org-confirm-babel-evaluate (lang body)
                                      (not (member lang '("emacs-lisp" "lisp" "scheme" "clojure" "python" "R" "C" "latex" "dot" "plantuml"))))
                                    (setq org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate))))

     (eval-after-load 'org
       #'(lambda ()
           (org-babel-do-load-languages
            'org-babel-load-languages
            '((emacs-lisp . t)
              (lisp . t)
              (clojure . t)
              (scheme . t)
              (C . t)
              (shell . t)
              (js . t)
              (python . t)
              (R . t)
              (http . t)
              (latex . t)
              (dot . t)
              (plantuml . t)))
           (add-to-list 'org-structure-template-alist '("py3" . "src python3"))
           (add-to-list 'org-structure-template-alist '("py" . "src python"))
           (add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp"))
           (add-to-list 'org-structure-template-alist '("lisp" . "src lisp"))
           (add-to-list 'org-structure-template-alist '("scheme" . "src scheme"))
           (add-to-list 'org-structure-template-alist '("sh" . "src sh"))
           (add-to-list 'org-structure-template-alist '("clojure" . "src clojure"))
           (add-to-list 'org-structure-template-alist '("r" . "src R"))
           (add-to-list 'org-structure-template-alist '("js" . "src js"))
           (add-to-list 'org-structure-template-alist '("http" . "src http"))
           (add-to-list 'org-structure-template-alist '("lt" . "LaTeX"))
           (add-to-list 'org-structure-template-alist '("dot" . "src dot :cmdline -Kdot -Tpng"))
           (add-to-list 'org-src-lang-modes (quote ("dot" . graphviz-dot)))
           (add-to-list 'org-structure-template-alist '("yaml" . "src yaml"))
           (add-to-list 'org-structure-template-alist '("json" . "src json"))
           (add-to-list 'org-structure-template-alist '("uml" . "src plantuml"))
           (add-to-list 'org-structure-template-alist '("latex" . "src latex"))))
   #+end_src

** align org tags
   #+begin_src emacs-lisp
     ;; (add-hook 'window-configuration-change-hook
     ;; 	  (lambda () (progn 
     ;; 		  (setq org-tags-column (- 7 (window-body-width)))
     ;; 		  (org-align-all-tags))))
   #+end_src

** Publishing Org-mode files to HTML
   #+begin_src emacs-lisp
     (use-package htmlize
       :defer 2
       :ensure t)

     ;; publish the ~/code/org/ project to HTML
     (require 'ox-publish)
     (setq org-publish-project-alist
	   '(;; the netes components, it publishes all the org-mode files to HTML 
	     ("org-notes"
	      :base-directory "~/code/org/"
	      :base-extension "org"
	      :publishing-directory "~/code/public_html/"
	      :recursive t
	      :publishing-function org-html-publish-to-html
	      :headline-levels 4
	      :auto-preamble t
	      :auto-sitemap t                  
	      :sitemap-filename "sitemap.org"  
	      :sitemap-title "Sitemap")
	     ("org-static"
	      :base-directory "~/code/org/"
	      :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf"
	      :publishing-directory "~/public_html/"
	      :recursive t
	      :publishing-function org-publish-attachment)
	     ("org" :components ("org-notes" "org-static"))
	
	     ("hugo-notes"
	      :base-directory "~/code/org/"
	      :base-extension "org"
	      :publishing-directory "~/code/my-site/content-org/"
	      :recursive t)))

   #+end_src

   #+RESULTS:

** Hugo + ox-hugo + Netlify
*** ox-hugo
    #+begin_src emacs-lisp
      (use-package ox-hugo
        :ensure t)
    #+end_src

    #+RESULTS:

*** org-capture
    * create corresponding .org file within the org folder inside HUGO site
    * each note/post will be inserted into the corresponding org file under second level headline (the first level is the corresponding file headline)
    * edit config/menus.toml, create link to section
    * edit content/home/<corresponding url name>.md, use computer-science.md as example:
      * line 3: # This section displays recent blog posts from `content/computer-science/`.
      * title = "Computer Science Posts"
      * line 15: page_type = "computer-science"
    * Note: need to mark the second level headline status as DONE to make it be visiable and searchable after being published.
    
    configuration for ~org-capture~
    #+begin_src emacs-lisp
      (defun org-hugo-new-subtree-post-capture-template ()
        "Returns `org-capture' template string for new Hugo post.
      See `org-capture-templates' for more information."
        (let* (;; http://www.holgerschurig.de/en/emacs-blog-from-org-to-hugo/
               (date (format-time-string (org-time-stamp-format  :inactive) (org-current-time)))
               (title (read-from-minibuffer "Post Title: ")) ;Prompt to enter the post title
               (fname (org-hugo-slug title)))
          (mapconcat #'identity
                     `(
                       ,(concat "* TODO " title)
                       ":PROPERTIES:"
                       ,(concat ":EXPORT_FILE_NAME: " fname)
                       ,(concat ":EXPORT_DATE: " date) ;Enter current date and time
                       ,(concat ":EXPORT_HUGO_CUSTOM_FRONT_MATTER+: "  ":weight 10 :autoCollapseToc true :mathjax true :contentCopyright MIT :author \"Z wei\"")
                       ":END:"
                       "%?\n")          ;Place th
                     "\n")))

      (defvar hugo-org-path "~/code/capture-org/"
        "define the place where we put our org files for hugo")
      (defvar org-capture-todo (concat hugo-org-path "todo.org"))
      (defvar org-capture-computer-science (concat hugo-org-path "computer-science.org"))
      (defvar org-capture-emacs (concat hugo-org-path "emacs.org"))
      (defvar org-capture-math (concat hugo-org-path "mathematics.org"))
      (defvar org-capture-software (concat hugo-org-path "software-engineering.org"))
      (defvar org-capture-tools (concat hugo-org-path "tools.org"))
      (defvar org-capture-work (concat hugo-org-path "work-notes.org"))
      (defvar org-capture-test (concat hugo-org-path "test.org"))
      ;; (defvar hugo-capture-orgs
      ;;   (list
      ;;    (cons 'computer (concat hugo-org-path "computer-science.org"))
      ;;    (cons 'emacs (concat hugo-org-path "emacs.org"))
      ;;    (cons 'math (concat hugo-org-path "mathematics.org"))
      ;;    (cons 'software (concat hugo-org-path "software-engineering.org"))
      ;;    (cons 'tools (concat hugo-org-path "tools.org"))
      ;;    (cons 'work (concat hugo-org-path "work-notes.org"))))

      (setq org-export-with-author nil)
      (setq org-capture-templates
            '(
              ("t" "todo" entry (file org-capture-todo)
               "* TODO %? :TODO: \n Added:%T\n"
               :clock-in t :clock-resume t)

              ;; ("ht" "test" entry (file org-capture-test)
              ;;  (function org-hugo-new-subtree-post-capture-template)
              ;;  :clock-in t :clock-resume t)

              ("h" "Hugo post")
        
              ;; ("hc" "Computer-Science"
              ;;  entry (file+olp org-capture-computer-science "Computer-Science")
              ;;  (function org-hugo-new-subtree-post-capture-template)
              ;;  :clock-in t :clock-resume t)
              ("hc" "Computer-Science"
               entry (file org-capture-computer-science)
               (function org-hugo-new-subtree-post-capture-template)
               :clock-in t :clock-resume t)

              ("he" "Emacs"
               entry (file org-capture-emacs)
               (function org-hugo-new-subtree-post-capture-template)
               :clock-in t :clock-resume t)

              ("hm" "Mathematics"
               entry (file org-capture-math)
               (function org-hugo-new-subtree-post-capture-template)
               :clock-in t :clock-resume t)

              ("hs" "Software-Engineering"
               entry (file org-capture-software)
               (function org-hugo-new-subtree-post-capture-template)
               :clock-in t :clock-resume t)

              ("ht" "Tools"
               ;; entry (file+olp org-capture-tools "Tools")
               entry (file org-capture-tools)
               (function org-hugo-new-subtree-post-capture-template)
               :clock-in t :clock-resume t)

              ("hw" "Work-Notes"
               entry (file org-capture-work)
               (function org-hugo-new-subtree-post-capture-template)
               :clock-in t :clock-resume t)))
    #+end_src

    #+RESULTS:
    | t | todo | entry | (file ~/code/my-site/org/todo.org) | * TODO %? :TODO: |

** Set the background of org-exported <code> blocks according to theme
   #+begin_src emacs-lisp
     (defun my/org-inline-css-hook (exporter)
       "Insert custom inline css to automatically set the
     background of code to whatever theme I'm using's background"
       (when (eq exporter 'html)
	 (let* ((my-pre-bg (face-background 'default))
		(my-pre-fg (face-foreground 'default)))
	   (setq
	    org-html-head-extra
	    (concat
	     org-html-head-extra
	     (format "<style type=\"text/css\">\n pre.src {background-color: %s; color: %s;}</style>\n"
		     my-pre-bg my-pre-fg))))))

     (add-hook 'org-export-before-processing-hook 'my/org-inline-css-hook)
   #+end_src

   #+RESULTS:
   | my/org-inline-css-hook |

** Github Flavored Markdown
   #+begin_src emacs-lisp
     (use-package ox-gfm
       :defer t
       :ensure t
       :config
       (progn
         (eval-after-load "org"
           '(require 'ox-gfm nil t))))
   #+end_src

** Capture screenshot within Emacs
   #+begin_src emacs-lisp
     (use-package org-attach-screenshot
       :commands (org-mode)
       :ensure t
       :config
       (progn
         (setq org-attach-screenshot-dirfunction
               (lambda () 
                 (progn (assert (buffer-file-name))
                        (concat (file-name-sans-extension (buffer-file-name))
                                "_att")))
               org-attach-screenshot-relative-links t)))
   #+end_src

** Org-download moving images from A to B
   #+begin_src emacs-lisp
     (use-package org-download
       :commands (org-mode)
       :ensure t
       :config
       (progn
         (add-hook 'dired-mode-hook 'org-download-enable)))
   #+end_src

   #+RESULTS:
   : t

** graphviz
   #+begin_src emacs-lisp
     ;; sudo apt install graphviz
     (use-package graphviz-dot-mode
       :commands (graphviz-dot-mode)
       :ensure t
       :init
       (setq graphviz-dot-indent-width 4)
       ;; :config 
       ;; (add-to-list 'auto-mode-alist '("\\.dot\\'" . graphviz-dot-mode))
       )
   #+end_src

   #+RESULTS:

   - [[https://anthonyskelton.com/2015/graphviz-a-better-way-to-create-flow-charts/][graphviz example01]]
   - [[http://melp.nl/2013/08/flow-charts-in-code-enter-graphviz-and-the-dot-language/][graphviz example02]]

** plantuml
   #+begin_src emacs-lisp
     (use-package plantuml-mode
       :commands (plantuml-mode)
       :ensure t
       :config
       (progn
         (setq plantuml-default-exec-mode 'jar)
         (setq plantuml-jar-path "~/.emacs.d/plantuml.jar")
         (setq plantuml-output-type "svg")
         ;; needed by ob-plantuml.el
         (setq org-plantuml-jar-path "~/.emacs.d/plantuml.jar")
         (add-to-list 'auto-mode-alist '("\\.plantuml\\'" . plantuml-mode))
         (add-hook 'plantuml-mode-hook '(lambda ()
                                          ;; (smartparens-mode)
                                          (setq-local company-backends (add-to-list 'company-backends 'plantuml-complete-symbol))))))
   #+end_src

   #+RESULTS:
   : t
   
* Markdown 
  - sudo apt install pandoc
  #+BEGIN_SRC emacs-lisp
    (use-package markdown-mode
      :ensure t
      :commands (markdown-mode gfm-mode)
      :mode (("README\\.md\\'" . gfm-mode)
             ("\\.md\\'" . markdown-mode)
             ("\\.markdown\\'" . markdown-mode))
      :init (setq markdown-command "multimarkdown"))
  #+END_SRC

  #+RESULTS:

* JSON-mode
  #+begin_src emacs-lisp
    (use-package json-mode
      :defer t
      :ensure t
      :config
      (progn
        (add-hook 'json-mode-hook
                  #'(lambda ()
                      (remove-hook 'before-save-hook #'clang-format-buffer-smart 'local)))))
  #+end_src
* Docker
  #+begin_src emacs-lisp
    ;; reference usage from http://manuel-uberti.github.io/emacs/2017/10/19/docker/
    (use-package dockerfile-mode
      :defer t
      :ensure t
      :init 
      (setq dockerfile-mode-command "docker"))
    (add-to-list 'auto-mode-alist '("Dockerfile\\'" . dockerfile-mode))

    (use-package docker-compose-mode
      :after (dockerfile-mode)
      :defer t
      :ensure t)

    (use-package docker-tramp
      ;; C-x C-f /docker:user@container:/path/to/file, where:
      ;; user is the user that you want to use
      ;; container is the id or name of the container 
      :defer t
      :ensure t
      :after (dockerfile-mode))

    (use-package eshell-bookmark
      :defer t 
      :after eshell
      :config 
      (add-hook 'eshell-mode-hook #'eshell-bookmark-setup))
  #+end_src

  #+RESULTS:

* PDF 
  * Use [[https://github.com/politza/pdf-tools][pdf-tools]], read the documentation to install dependencies according to your system.
  * Dependencies on Ubuntu
    #+begin_src sh
      sudo apt install autoconf automake g++ gcc libpng-dev libpoppler-dev libpoppler-glib-dev libpoppler-private-dev libz-dev make pkg-config
    #+end_src
  * Configuration 
  #+begin_src emacs-lisp
    ;; (unless (string-equal system-type "windows-nt")
    ;;   ;; Haven't build pdf-tool dependencies on other system
    ;;   (use-package pdf-tools
    ;;     ;; :pin manual
    ;;     :init
    ;;     (use-package tablist
    ;;       :ensure t)
    ;;     :ensure t
    ;;     :config
    ;;     ;; initialise
    ;;     (pdf-tools-install)
    ;;     ;; PDF Tools does not work well together with linum-mode
    ;;     (add-hook 'pdf-view-mode-hook (lambda() (nlinum-mode -1)))
    ;;     ;; more fine-grained zooming
    ;;     ;; (setq pdf-view-resize-factor 1.1)
    ;;     ;; open pdfs scaled to fit page
    ;;     (setq-default pdf-view-display-size 'fit-width)
    ;;     ;; automatically annotate highlights
    ;;     (setq pdf-annot-activate-created-annotations t)

    ;;     ;; use normal isearch
    ;;     (define-key pdf-view-mode-map (kbd "C-s") 'isearch-forward))

    ;;   (use-package org-pdfview
    ;;     :ensure t))
  #+end_src

  #+RESULTS:

  * If meet error: "dyld: Library not loaded: /usr/local/opt/mpfr/lib/libmpfr.4.dylib Referenced from: /usr/local/bin/gawk" during the compliation of pdf-tools.
    Solution: ~brew upgrade gawk~

* highlight-symbol
  # #+begin_src emacs-lisp
  #   (use-package idle-highlight-mode
  #     :defer 2
  #     :ensure t
  #     :init 
  #     (define-globalized-minor-mode my-global-idle-highlight-mode idle-highlight-mode
  #       (lambda ()
  #         (idle-highlight-mode 1)))
  #     (my-global-idle-highlight-mode 1))
  # #+end_src
* Folding
  * [[https://github.com/gregsexton/origami.el][Origami]]
  * [[https://github.com/zenozeng/yafolding.el][yafolding ]]
  * [[https://github.com/mrkkrp/vimish-fold][vimish-fold]]
  #+begin_src emacs-lisp
    (use-package yafolding
      :defer t
      :init (global-set-key (kbd "<f9>") 'yafolding-toggle-element)
      :commands (yafolding-toggle-element)
      :ensure t)
  #+end_src

  #+RESULTS:
  : t

* Indentation
** indent guide
*** Refs   
    * [[https://github.com/antonj/Highlight-Indentation-for-Emacs][Highlight-Indentation-for-Emacs]]
    * [[https://github.com/DarthFennec/highlight-indent-guides][highlight-indent-guides]]
    * [[https://github.com/zk-phi/indent-guide][indent-guide]]
*** highlight-indent-guides
    #+begin_src emacs-lisp
      (use-package highlight-indent-guides
        :ensure t
        :config 
        (progn
          (setq highlight-indent-guides-delay 0.1)
          ;; (add-hook 'prog-mode-hook #'highlight-indent-guides-mode)
          ;; (add-hook 'plantuml-mode-hook 'highlight-indent-guides-mode)
          (add-hook 'json-mode-hook 'highlight-indent-guides-mode)
          (add-hook 'yaml-mode-hook 'highlight-indent-guides-mode)))
    #+end_src

*** indent-guide
    #+begin_src emacs-lisp
      ;; (use-package indent-guide
      ;;   :ensure t
      ;;   :config
      ;;   (progn
      ;;     (setq indent-guide-delay 0.1)
      ;;     (add-hook 'prog-mode-hook 'indent-guide-mode)))
    #+end_src

** indentation using tab/space
   #+begin_src emacs-lisp
     ;; START TABS CONFIG
     ;; Create a variable for our preferred tab width
     (setq custom-indent-width 2)

     ;; Two callable functions for enabling/disabling tabs in Emacs
     (defun disable-tabs () 
       (progn
         (setq-default indent-tabs-mode nil)
         (setq indent-tabs-mode nil)))

     (defun enable-tabs  ()
       (progn
         ;; (local-set-key (kbd "TAB") 'tab-to-tab-stop)
         (setq-default tab-width custom-indent-width)
         (setq tab-width custom-indent-width)
         (setq indent-tabs-mode t)))

     (add-hook 'after-init-hook '(lambda ()
                                   ;; Hooks to Enable Tabs
                                   ;; (add-hook 'prog-mode-hook 'enable-tabs)
                                   ;; (add-hook 'org-mode-hook 'enable-tabs)
                                   (add-hook 'plantuml-mode-hook '(lambda ()
                                                                    ;; plantuml seems always use tabs to do indent format
                                                                    (enable-tabs)
                                                                    (setq plantuml-indent-level custom-indent-width)))

                                   ;; Hooks to Disable Tabs, since tab usually cause inconsistent visual appearence
                                   (add-hook 'prog-mode-hook 'disable-tabs)
                                   (add-hook 'org-mode-hook 'disable-tabs)
                                   (add-hook 'json-mode-hook 'disable-tabs)
                                   (add-hook 'lisp-mode-hook 'disable-tabs)
                                   (add-hook 'emacs-lisp-mode-hook 'disable-tabs)
                                   (add-hook 'yaml-mode-hook 'disable-tabs)

                                   ;; Language-Specific Tweaks
                                   (add-hook 'python-mode-hook '(lambda ()
                                                                  (setq-default python-indent-offset custom-indent-width)
                                                                  (setq python-indent-offset custom-indent-width)))))

     ;; (setq-default js-indent-level custom-indent-width)      ;; Javascript

     ;; Making electric-indent behave sanely
     (setq-default electric-indent-inhibit nil)

     ;; Make the backspace properly erase the tab instead of
     ;; removing 1 space at a time.
     (setq backward-delete-char-untabify-method 'hungry)

     ;; ;; WARNING: This will change your life
     ;; ;; (OPTIONAL) Visualize tabs as a pipe character - "|"
     ;; ;; This will also show trailing characters as they are useful to spot.
     ;; (setq whitespace-style '(face tabs tab-mark trailing))
     ;; (custom-set-faces
     ;;  '(whitespace-tab ((t (:foreground "#636363")))))
     ;; (setq whitespace-display-mappings
     ;;   '((tab-mark 9 [124 9] [92 9]))) ; 124 is the ascii ID for '\|'
     ;; (global-whitespace-mode) ; Enable whitespace mode everywhere

     ;; END TABS CONFIG
   #+end_src

   #+RESULTS:
   : hungry

* Lookup word definition
  * Ref: (see [[https://oremacs.com/2015/05/22/define-word/][New on MELPA - define word at point]])
  
* Hydra
  #+begin_src emacs-lisp
    (use-package hydra
      :ensure t
      :defer t)
  #+end_src

* Unpackaged
A collection of useful Emacs Lisp code that isn’t substantial enough to be packaged. This code will be maintained here so that it can be updated and improved over time.

** Mark current package for upgrading
   #+begin_src emacs-lisp
      (use-package package
        :bind (:map package-menu-mode-map
                    ("t" . #'package-menu-upgrade-package))
        :config
        (defun package-menu-upgrade-package ()
          "Mark current package for upgrading (i.e. also mark obsolete version for deletion.)"
          (interactive)
          (when-let ((upgrades (package-menu--find-upgrades))
                     (description (tabulated-list-get-id))
                     (name (package-desc-name description))
                     (upgradable (cdr (assq name upgrades))))
            ;; Package is upgradable
            (save-excursion
              (goto-char (point-min))
              (while (not (eobp))
                (let* ((current-description (tabulated-list-get-id))
                       (current-name (package-desc-name current-description)))
                  (when (equal current-name name)
                    (cond ((equal description current-description)
                           (package-menu-mark-install)
                           (forward-line -1))
                          (t (package-menu-mark-delete)))))
                (forward-line 1))))))
   #+end_src

** Smerge with hydra 
   #+begin_src emacs-lisp
    (use-package smerge-mode
      :after hydra
      :init 
      (setq smerge-command-prefix "\C-cv")
      :config
      (defhydra unpackaged/smerge-hydra
        (:color pink :hint nil :post (smerge-auto-leave))
        "
    ^Move^       ^Keep^               ^Diff^                 ^Other^
    ^^-----------^^-------------------^^---------------------^^-------
    _n_ext       _b_ase               _<_: upper/base        _C_ombine
    _p_rev       _u_pper              _=_: upper/lower       _r_esolve
    ^^           _l_ower              _>_: base/lower        _k_ill current
    ^^           _a_ll                _R_efine
    ^^           _RET_: current       _E_diff
    "
        ("n" smerge-next)
        ("p" smerge-prev)
        ("b" smerge-keep-base)
        ("u" smerge-keep-upper)
        ("l" smerge-keep-lower)
        ("a" smerge-keep-all)
        ("RET" smerge-keep-current)
        ("\C-m" smerge-keep-current)
        ("<" smerge-diff-base-upper)
        ("=" smerge-diff-upper-lower)
        (">" smerge-diff-base-lower)
        ("R" smerge-refine)
        ("E" smerge-ediff)
        ("C" smerge-combine-with-next)
        ("r" smerge-resolve)
        ("k" smerge-kill-current)
        ("ZZ" (lambda ()
                (interactive)
                (save-buffer)
                (bury-buffer))
         "Save and bury buffer" :color blue)
        ("q" nil "cancel" :color blue))
      :hook (magit-diff-visit-file . (lambda ()
                                       (when smerge-mode
                                         (unpackaged/smerge-hydra/body)))))
   #+end_src
* Sudo-edit
  #+begin_src emacs-lisp
    (use-package sudo-edit
      :ensure t
      :defer 1)
  #+end_src
* Nyan
  #+begin_src emacs-lisp
    (use-package nyan-mode
      :ensure t
      :config
      (nyan-mode 1)
      (setq nyan-cat-face-number 3))
  #+end_src

  #+RESULTS:
  : t

* Dashboard
  #+begin_src emacs-lisp
    (use-package dashboard
      :ensure t
      :config
      (dashboard-setup-startup-hook)
      (setq initial-buffer-choice (lambda () (get-buffer "*dashboard*")))
      (setq dashboard-items '((recents . 10)
                              (projects . 5))))
  #+end_src

* Latex
** setup
    #+begin_src emacs-lisp
      (use-package auctex
        :ensure t
        :defer t
        :mode ("\\.tex\\'" . LaTex-mode)
        :bind (:map LaTeX-mode-map
                    ("M-<delete>" . TeX-remove-macro)
                    ("C-c C-r" . reftex-query-replace-document)
                    ("C-c C-g" . reftex-grep-document))
        :init
        ;; define texbin execution path based on system
        (cond ((eq system-type 'darwin)
               (setq exec-path (append exec-path '("/Library/TeX/texbin/")))))
        ;; A function to delete the current macro in AUCTeX.
        ;; Note: keybinds won't be added to TeX-mode-hook if not kept at the end of the AUCTeX setup!
        (defun TeX-remove-macro ()
          "Remove current macro and return TRUE, If no macro at point, return Nil."
          (interactive)
          (when (TeX-current-macro)
            (let ((bounds (TeX-find-macro-boundaries))
                  (brace  (save-excursion
                            (goto-char (1- (TeX-find-macro-end)))
                            (TeX-find-opening-brace))))
              (delete-region (1- (cdr bounds)) (cdr bounds))
              (delete-region (car bounds) (1+ brace)))
            t))
        :config
        (setq-default TeX-master nil ; by each new fie AUCTEX will ask for a master fie.
                      TeX-PDF-mode t
                      TeX-engine 'xetex)     ; optional
        (setq TeX-auto-save t
              TeX-save-query nil       ; don't prompt for saving the .tex file
              TeX-parse-self t
              TeX-show-compilation nil         ; if `t`, automatically shows compilation log
              LaTeX-babel-hyphen nil ; Disable language-specific hyphen insertion.
              ;; `"` expands into csquotes macros (for this to work, babel pkg must be loaded after csquotes pkg).
              LaTeX-csquotes-close-quote "}"
              LaTeX-csquotes-open-quote "\\enquote{"
              TeX-file-extensions '("Rnw" "rnw" "Snw" "snw" "tex" "sty" "cls" "ltx" "texi" "texinfo" "dtx"))

        (add-to-list 'TeX-command-list
                     '("Makeglossaries" "makeglossaries %s" TeX-run-command nil
                       (latex-mode)
                       :help "Run makeglossaries script, which will choose xindy or makeindex") t)

        ;; Font-lock for AuCTeX
        ;; Note: '«' and '»' is by pressing 'C-x 8 <' and 'C-x 8 >', respectively
        (font-lock-add-keywords 'latex-mode (list (list "\\(«\\(.+?\\|\n\\)\\)\\(+?\\)\\(»\\)" '(1 'font-latex-string-face t) '(2 'font-latex-string-face t) '(3 'font-latex-string-face t))))
        ;; Add standard Sweave file extensions to the list of files recognized  by AuCTeX.
        (add-hook 'LaTex-mode-hook (lambda ()
                                     (load "preview-latex.el" nil t t)
                                     (reftex-isearch-minor-mode)
                                     (turn-on-reftex))))
    #+end_src

** company
   #+begin_src emacs-lisp
     (use-package company-math
       :ensure t
       :config
       (add-hook 'LaTeX-mode-hook (lambda ()
                                    (setq-local company-backends (add-to-list 'company-backends 'company-math-symbols-latex))
                                    (setq-local company-backends (add-to-list 'company-backends 'company-latex-commands))
                                    (setq-local company-backends (add-to-list 'company-backends 'company-math-symbols-unicode))))
       (add-hook 'org-mode-hook (lambda ()
                                  (setq-local company-backends (add-to-list 'company-backends 'company-math-symbols-unicode))
                                  (setq-local company-backends (add-to-list 'company-backends 'company-latex-commands)))))
   #+end_src

   #+RESULTS:
   : t

** indentation
   #+begin_src emacs-lisp
     (eval-after-load 'tex
       '(setq LaTeX-indent-environment-list
              '(("itemize" LaTeX-indent-tabular)
                ("enumerate" LaTeX-indent-tabular)
                ("verbatim" current-indentation)
                ("verbatim*" current-indentation)
                ("tabular" LaTeX-indent-tabular)
                ("tabular*" LaTeX-indent-tabular)
                ("align" LaTeX-indent-tabular)
                ("align*" LaTeX-indent-tabular)
                ("array" LaTeX-indent-tabular)
                ("eqnarray" LaTeX-indent-tabular)
                ("eqnarray*" LaTeX-indent-tabular)
                ("multline" LaTeX-indent-tabular)
                ("displaymath")
                ("equation")
                ("equation*")
                ("picture")
                ("tabbing"))))
   #+end_src

** bindings
   #+begin_src emacs-lisp
     (eval-after-load 'tex
       '(progn
          (defun save-compile-latex ()
            "Save and compile latex document"
            (interactive)
            (save-buffer)
            (TeX-command-sequence t t))

          (defun complete-if-no-space ()
            (interactive)
            (let ((cb (string (char-before))))
              (if (or (equal cb " ") (equal (point) (line-beginning-position)))
                  (tab-to-tab-stop)
                (TeX-complete-symbol))))

          (add-hook 'LaTeX-mode-hook (lambda ()
                                       (define-key LaTeX-mode-map (kbd "<f5>") 'save-compile-latex)
                                       (define-key LaTeX-mode-map (kbd "<f7>") 'preview-clearout-buffer)
                                       (define-key LaTeX-mode-map (kbd "TAB") 'complete-if-no-space)
                                       (define-key LaTeX-mode-map (kbd "<tab>") 'complete-if-no-space)))))
   #+end_src

** preview
   #+begin_src emacs-lisp
     (eval-after-load 'preview
       '(progn
          (set-default 'preview-scale-function 1.7)
          (set-default 'preview-default-option-list
                       '("displaymath" "floats" "graphics" "textmath"))))
   #+end_src

** test output
   - latex code block
     #+begin_src latex
       Integral $\int_{a}^{b} x^2 dx$ inside text
     #+end_src
** Reference
   - [[https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-LaTeX.html][LaTex Source Code Blocks in Org Mode]]
   - [[http://www.stat.rice.edu/~helpdesk/compguide/node39.html][Latex/Emacs tex mode]]
